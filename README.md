# Audio Spectrum Analyzer on RP2040 + WS2812B 16√ó16 (MicroPython)

–û–±—á–∏—Å–ª–µ–Ω–Ω—è —Å–ø–µ–∫—Ç—Ä–∞ –∞—É–¥—ñ–æ—Å–∏–≥–Ω–∞–ª—É —Ç–∞ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –π–æ–≥–æ –Ω–∞ RGB LED-–º–∞—Ç—Ä–∏—Ü—ñ **WS2812B 16√ó16** (NeoPixel) —É **MicroPython** –Ω–∞ **RP2040 (Raspberry Pi Pico)**.

---

## üì¶ –û—Å–Ω–æ–≤–Ω—ñ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

### –í—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
- –î—ñ–∞–ø–∞–∑–æ–Ω –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è: **‚âà 40 –ì—Ü ‚Ä¶ 18 –∫–ì—Ü** (–æ–±–º–µ–∂—É—î—Ç—å—Å—è `IND_BANDS`, `Fs`, `FFT_SIZE`)
- **16 —á–∞—Å—Ç–æ—Ç–Ω–∏—Ö —Å–º—É–≥**, —Ä–æ–∑–±–∏—Ç—Ç—è ‚Äú–ª–æ–≥–∞—Ä–∏—Ñ–º—ñ—á–Ω–æ-–ø–æ–¥—ñ–±–Ω–µ‚Äù
- **16 —Ä—ñ–≤–Ω—ñ–≤ (0..16)** –¥–ª—è –∫–æ–∂–Ω–æ—ó —Å–º—É–≥–∏, –º–∞—Å—à—Ç–∞–±—É–≤–∞–Ω–Ω—è –≤—ñ–¥ `dBFS`
- –î–∏–Ω–∞–º—ñ—á–Ω–∏–π –º–∞—Å—à—Ç–∞–± **AGC –ø–æ —Å–º—É–≥–∞—Ö** (—Å—Ç–∞–±—ñ–ª—å–Ω–µ –≤—ñ–∑—É–∞–ª—å–Ω–µ —Å–ø—ñ–≤–≤—ñ–¥–Ω–æ—à–µ–Ω–Ω—è —Å–∫–ª–∞–¥–æ–≤–∏—Ö –ø—Ä–∏ –∑–º—ñ–Ω—ñ –≥—É—á–Ω–æ—Å—Ç—ñ)
- –ß–∞—Å—Ç–æ—Ç–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ–Ω–¥–∏–∫–∞—Ü—ñ—ó: **~14 FPS** (–∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ —Ç–∞ —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó; –¥–∏–≤. —Ä–æ–∑–¥—ñ–ª ‚Äú–ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å‚Äù)

### FFT
- –†–æ–∑–º—ñ—Ä: **N = 1024**
- –í—ñ–∫–Ω–æ: **Hann window** (–≤—ñ–∫–Ω–æ –•–∞–Ω–Ω–∞)
- –†–µ–∞–ª—ñ–∑–∞—Ü—ñ—è FFT: **kissFFT (float)** + –æ–±—á–∏—Å–ª–µ–Ω–Ω—è –µ–Ω–µ—Ä–≥—ñ—ó –≤ C —á–µ—Ä–µ–∑ –º–æ–¥—É–ª—å `fastfft`  
  –†–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π: https://github.com/Alex-Teteria/Fast-FFT-module-for-MicroPython-RP2040-

### ADC (RP2040)
- –ß–∞—Å—Ç–æ—Ç–∞ —Å–µ–º–ø–ª—É–≤–∞–Ω–Ω—è: **Fs = 44 –∫–ì—Ü**, Nyquist = 22 –∫–ì—Ü
- –ó–∞—Ö–≤–∞—Ç: C-–º–æ–¥—É–ª—å `adc_dma` (one-shot/burst, –∞–ø–∞—Ä–∞—Ç–Ω–µ —Ç–∞–∫—Ç—É–≤–∞–Ω–Ω—è, DMA —É RAM)  
  –†–µ–ø–æ–∑–∏—Ç–æ—Ä—ñ–π: https://github.com/Alex-Teteria/MicroPython-RP2040-ADC-DMA-Extension
- –û–∫—Ä–µ–º–∏–π –∞–Ω–∞–ª–æ–≥–æ–≤–∏–π –∞–Ω—Ç–∏–∞–ª—ñ–∞—Å–æ–≤–∏–π —Ñ—ñ–ª—å—Ç—Ä –Ω–µ –∑–∞—Å—Ç–æ—Å–æ–≤–∞–Ω–æ; –≤—Ö—ñ–¥–Ω–∏–π —Ç—Ä–∞–∫—Ç (–µ–ª–µ–∫—Ç—Ä–µ—Ç–Ω–∏–π –º—ñ–∫—Ä–æ—Ñ–æ–Ω + MAX4466) –ø—Ä–∏–∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è –∞—É–¥—ñ–æ –π –º–∞—î –æ–±–º–µ–∂–µ–Ω—É –∫–æ—Ä–∏—Å–Ω—É —Å–º—É–≥—É. –î–ª—è –∑–º–µ–Ω—à–µ–Ω–Ω—è –≤–ø–ª–∏–≤—É –º–æ–∂–ª–∏–≤–∏—Ö –í–ß –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ñ–≤ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ–±–º–µ–∂—É—î –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –¥–æ ~18 –∫–ì—Ü. –ó–∞ –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ –í–ß –ø–µ—Ä–µ—à–∫–æ–¥ –º–æ–∂–ª–∏–≤–∏–π –∞–ª—ñ–∞—Å–∏–Ω–≥; —É —Ç–∞–∫–æ–º—É —Ä–∞–∑—ñ —Ä–µ–∫–æ–º–µ–Ω–¥—É—î—Ç—å—Å—è –ø—Ä–æ—Å—Ç–∏–π RC low-pass –ø–µ—Ä–µ–¥ ADC.

---

## üèóÔ∏è –ê–ø–∞—Ä–∞—Ç–Ω–∞ —á–∞—Å—Ç–∏–Ω–∞ —Ç–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è

### –ú–æ–¥—É–ª—ñ
- MAX4466 electret mic amplifier module (–º—ñ–∫—Ä–æ—Ñ–æ–Ω + –ø—ñ–¥—Å–∏–ª—é–≤–∞—á)
- WS2812B RGB LED matrix 16√ó16 (256 LED)
- Raspberry Pi Pico / RP2040

### –ñ–∏–≤–ª–µ–Ω–Ω—è —Ç–∞ —Å–∏–≥–Ω–∞–ª–∏
- MAX4466 –∂–∏–≤–∏—Ç–∏ –≤—ñ–¥ **3.3V** Pico.
- –í–∏—Ö—ñ–¥ MAX4466 –º–∞—î **DC offset ~VCC/2**, —Ç–æ–º—É –º–æ–∂–µ –ø–æ–¥–∞–≤–∞—Ç–∏—Å—å –Ω–∞–ø—Ä—è–º—É –Ω–∞ ADC.
- LED-–º–∞—Ç—Ä–∏—Ü—é WS2812B –∂–∏–≤–∏—Ç–∏ –≤—ñ–¥ **5V –æ–∫—Ä–µ–º–∏–º –¥–∂–µ—Ä–µ–ª–æ–º** (—Å—Ç—Ä—É–º –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥ —è—Å–∫—Ä–∞–≤–æ—Å—Ç—ñ —Ç–∞ –∫–æ–ª—å–æ—Ä—ñ–≤).
- –û–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ –∑—Ä–æ–±–∏—Ç–∏ **—Å–ø—ñ–ª—å–Ω—É –∑–µ–º–ª—é (GND)** –º—ñ–∂ Pico —Ç–∞ 5V LED-–¥–∂–µ—Ä–µ–ª–æ–º.
- DATA –ª—ñ–Ω—ñ—è WS2812B:
  - –ø—ñ–¥–∫–ª—é—á–∏—Ç–∏ –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ —Ä–µ–∑–∏—Å—Ç–æ—Ä **330‚Äì470 Œ©** —É DATA –±—ñ–ª—è –≤—Ö–æ–¥—É –º–∞—Ç—Ä–∏—Ü—ñ.

### –ü—ñ–Ω–∏ 
- ADC: GPIO26 / ADC0
- NeoPixel DATA: GPIO20 (–≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î `neo_pin=20` —É –∫–æ–¥—ñ)

---

## üß© –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è / –ø—Ä–æ—à–∏–≤–∫–∞

–ü—Ä–æ—î–∫—Ç –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î –º–æ–¥—É–ª—ñ `adc_dma` —Ç–∞ `fastfft`. –ü–æ—Ç—Ä—ñ–±–Ω–∞ –∑–±—ñ—Ä–∫–∞ MicroPython –¥–ª—è RP2040, –¥–µ —Ü—ñ C-–º–æ–¥—É–ª—ñ –≤—à–∏—Ç—ñ —É –ø—Ä–æ—à–∏–≤—Ü—ñ.

–î–∞–ª—ñ:
1. –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –Ω–∞ Pico —Ñ–∞–π–ª–∏:
   - `neo_spectr.py`
   - `neo_matrix.py`
   - `build_band_spectr.md` (–¥–æ–≤—ñ–¥–∫–∞)
2. –ó–∞–ø—É—Å—Ç–∏—Ç–∏ `neo_spectr.py`.

---

## :page_facing_up: –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è —Ñ–∞–π–ª—ñ–≤

| –§–∞–π–ª | –ü—Ä–∏–∑–Ω–∞—á–µ–Ω–Ω—è |
| --- | --- |
| `neo_spectr.py` | –û—Å–Ω–æ–≤–Ω–∏–π –∫–æ–¥ (ADC ‚Üí FFT ‚Üí 16 —Å–º—É–≥ ‚Üí LED) |
| `neo_matrix.py` | –ö–ª–∞—Å `NeoMatrixFast` –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ —Ä–µ–Ω–¥–µ—Ä—É WS2812B 16√ó16 (viper + –ø—Ä—è–º–∏–π –±—É—Ñ–µ—Ä) |
| `build_band_spectr.md` | –û–ø–∏—Å –∞–ª–≥–æ—Ä–∏—Ç–º—É —Ç–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ —Ñ—É–Ω–∫—Ü—ñ—ó `build_band_spectr()` |

---

## ‚öôÔ∏è –ö–ª—é—á–æ–≤—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏

- `FFT_SIZE = 1024`
- `SAMPLE_FREQ = 44_000`
- `IND_BANDS` ‚Äî —Ä–æ–∑–±–∏—Ç—Ç—è –±—ñ–Ω—ñ–≤ FFT –Ω–∞ 16 —Å–º—É–≥
- `NOISE_THRESHOLD` ‚Äî –ø–æ—Ä–æ–≥–∏ —à—É–º—É –ø–æ —Å–º—É–≥–∞—Ö
- AGC –ø–∞—Ä–∞–º–µ—Ç—Ä–∏: `HEADROOM_DB`, `SCALE_DECAY_DB`, `SCALE_MIN_DB`, `GAMMA`

---

## üìà –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å 

–ö–∞–¥—Ä –≤–∫–ª—é—á–∞—î:
- —á–∞—Å –∑–∞—Ö–≤–∞—Ç—É: `FFT_SIZE / Fs` (–¥–ª—è 1024/44k ‚âà 23.27 ms)
- FFT (–¥–ª—è N=1024 + –≤—ñ–∫–Ω–æ ‚âà 35 ms)
- –∞–≥—Ä–µ–≥–∞—Ü—ñ—è —Å–º—É–≥ + AGC (‚âà 12 ms)
- –≤–∏–≤—ñ–¥ WS2812B: `np.write()` (–¥–ª—è 256 LED —Ç–∏–ø–æ–≤–æ ~7‚Äì8 ms)

–§–∞–∫—Ç–∏—á–Ω–∏–π FPS –∑–∞–ª–µ–∂–∏—Ç—å –≤—ñ–¥:
- —Ä–µ–∞–ª—ñ–∑–∞—Ü—ñ—ó `fastfft`
- –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤ AGC/–ª–æ–≥–∞—Ä–∏—Ñ–º—ñ–≤
- —è—Å–∫—Ä–∞–≤–æ—Å—Ç—ñ/–æ–Ω–æ–≤–ª–µ–Ω–Ω—è LED —Ç–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏ –ø–æ—Ç–æ–∫—É –≤–∏–∫–æ–Ω–∞–Ω–Ω—è  

–£ –ø—Ä–æ—î–∫—Ç—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–æ 2 —è–¥—Ä–∞ RP2040:  
- **Core0**: –∑–∞—Ö–≤–∞—Ç ADC (`FFT_SIZE/Fs`), FFT, –∞–≥—Ä–µ–≥–∞—Ü—ñ—è —Å–º—É–≥, AGC, –ø—ñ–¥–≥–æ—Ç–æ–≤–∫–∞ `spec_back/max_back` —ñ –ø—É–±–ª—ñ–∫–∞—Ü—ñ—è –∫–∞–¥—Ä—É (swap).
- **Core1**: —Ä–µ–Ω–¥–µ—Ä –±—É—Ñ–µ—Ä–∞ (`viper`) —Ç–∞ –≤–∏–≤—ñ–¥ –Ω–∞ –º–∞—Ç—Ä–∏—Ü—é `np.write()` (WS2812B).

–¢–æ–º—É `np.write()` **–Ω–µ –∑–±—ñ–ª—å—à—É—î –ª–∞—Ç–µ–Ω—Ç–Ω—ñ—Å—Ç—å DSP-–∫–∞–¥—Ä–∞ –Ω–∞ Core0** —É —Ä–µ–∂–∏–º—ñ `DROP_FRAMES=True`,
–∞–ª–µ –æ–±–º–µ–∂—É—î **–º–∞–∫—Å–∏–º–∞–ª—å–Ω—É —á–∞—Å—Ç–æ—Ç—É –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ–Ω–¥–∏–∫–∞—Ü—ñ—ó** (–ø—Ä–æ–ø—É—Å–∫ –∫–∞–¥—Ä—ñ–≤ –º–æ–∂–ª–∏–≤–∏–π, —è–∫—â–æ Core0 –≥–µ–Ω–µ—Ä—É—î –∫–∞–¥—Ä–∏ —à–≤–∏–¥—à–µ, –Ω—ñ–∂ Core1 –≤—Å—Ç–∏–≥–∞—î —ó—Ö –ø–æ–∫–∞–∑—É–≤–∞—Ç–∏).  
–£ —Ä–µ–∂–∏–º—ñ `DROP_FRAMES=False` Core0 –æ—á—ñ–∫—É—î, –¥–æ–∫–∏ Core1 –∑–∞–±–µ—Ä–µ –∫–∞–¥—Ä, —ñ —Ç–æ–¥—ñ `np.write()` –Ω–∞–ø—Ä—è–º—É –æ–±–º–µ–∂—É—î —á–∞—Å—Ç–æ—Ç—É –≤—Å—ñ—î—ó —Å–∏—Å—Ç–µ–º–∏.

---

## üîß –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó (–±–µ–∑ AA-—Ñ—ñ–ª—å—Ç—Ä–∞)
–Ø–∫—â–æ —É –≤–µ—Ä—Ö–Ω—ñ–π —á–∞—Å—Ç–∏–Ω—ñ —Å–ø–µ–∫—Ç—Ä–∞ –ø–æ–º—ñ—Ç–Ω—ñ ‚Äú–¥–∏–≤–Ω—ñ‚Äù –ø—ñ–∫–∏/—à—É–º:
- –æ–±–º–µ–∂–∏—Ç–∏ –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è –¥–æ 12‚Äì16 –∫–ì—Ü —á–µ—Ä–µ–∑ `IND_BANDS`
- –¥–æ–¥–∞—Ç–∏ –ø—Ä–æ—Å—Ç–∏–π RC low-pass –ø–µ—Ä–µ–¥ ADC (1-–π –ø–æ—Ä—è–¥–æ–∫):
  - –ø—Ä–∏–∫–ª–∞–¥: R=1 –∫Œ© –ø–æ—Å–ª—ñ–¥–æ–≤–Ω–æ, C=10 –Ω–§ –Ω–∞ GND (fc ‚âà 16 –∫–ì—Ü)

---

## üìÑ Credits and License
- Licensed under MIT.
- **kissFFT**: This project uses the [kissFFT](https://github.com/mborgerding/kissfft) library by Mark Borgerding, licensed under the **BSD 3-Clause License**.
